<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Devocional Di√°rio ‚Ä¢ Um Dedo de F√©</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --marrom-escuro: #4b2a1a;
      --marrom-claro: #7b4c27;
      --dourado: #e1a640;
      --bege-fundo: #efe2c3;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--bege-fundo);
      color: var(--marrom-escuro);
      margin: 0;
      padding: 0;
      line-height: 1.8;
    }

    /* ===== HEADER ===== */
    header {
      background-color: var(--bege-fundo);
      text-align: center;
      padding: 20px 0 10px;
      border-bottom: 2px solid var(--dourado);
    }

    /* ===== BANNER ===== */
    .banner-container {
      text-align: center;
      margin: 0 auto;
    }

    #banner-promocional {
      width: 100%;
      max-width: 700px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      transition: transform 0.2s ease;
    }

    #banner-promocional:hover {
      transform: scale(1.02);
    }

    /* ===== BOT√ÉO PLAY ===== */
    #btn-ouvir {
      display: block;
      margin: 20px auto;
      padding: 12px 25px;
      font-size: 1.05em;
      background-color: var(--dourado);
      color: var(--marrom-escuro);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s ease;
    }

    #btn-ouvir:hover {
      background-color: #d49b2f;
    }

    /* ===== MAIN ===== */
    main {
      max-width: 800px;
      margin: 0 auto 20px auto;
      background: #fff8ef;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.05);
    }

    h1 {
      color: var(--marrom-escuro);
      font-size: 1.9em;
      margin-bottom: 10px;
      text-align: center;
    }

    .verse {
      font-weight: 600;
      color: var(--marrom-claro);
      text-align: center;
      margin-bottom: 20px;
    }

    .content p {
      margin-bottom: 20px;
      font-size: 1.05em;
    }

    .content p strong {
      color: var(--dourado);
    }

    .content p em {
      color: var(--marrom-claro);
      font-style: italic;
    }

    .reflection, .practical, .prayer {
      border-left: 4px solid var(--dourado);
      padding-left: 16px;
      margin: 30px 0;
      background: #fff3e0;
    }

    .prayer {
      background: #fef5e4;
      border: 1px solid #f1c27d;
      padding: 16px;
      border-radius: 10px;
      margin-top: 25px;
    }

    /* ===== FOOTER ===== */
    footer {
      text-align: center;
      font-size: 0.9em;
      padding: 30px 0;
      color: var(--marrom-claro);
    }

    footer a {
      color: var(--dourado);
      text-decoration: none;
      font-weight: 600;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* ===== RESPONSIVIDADE ===== */
    @media (max-width: 768px) {
      #banner-promocional {
        max-width: 95%;
        border-radius: 10px;
      }

      main {
        margin: 10px 5px 0 5px;
        padding: 15px;
      }

      h1.titulo-devocional {
        font-size: 1.6em;
        line-height: 1.2;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="banner-container">
      <a href="https://wa.me/5527999080664?text=Quero%20aproveitar%20a%20promo%C3%A7%C3%A3o" target="_blank" rel="noopener noreferrer">
        <img id="banner-promocional" src="imagens/banner-promocional.jpg" alt="Banner promocional da caneca devocional">
      </a>
    </div>
  </header>

  <!-- Bot√£o de leitura -->
  <button id="btn-ouvir">üîä Ouvir devocional</button>

  <main id="devocional">
    <p style="text-align:center;">Carregando devocional...</p>
  </main>

  <footer>
    <p>¬© 2025 <strong>Um Dedo de F√©</strong> ‚Äî por 
      <a href="https://www.instagram.com/prwevertonquintino/" target="_blank">@prwevertonquintino</a>
    </p>
  </footer>

  <script>
    const totalDevocionais = 365;

    // Obt√©m ou define a data de in√≠cio da jornada
    let dataInicio = localStorage.getItem("dataInicioDevocional");
    if (!dataInicio) {
      dataInicio = new Date().toISOString();
      localStorage.setItem("dataInicioDevocional", dataInicio);
    }

    // === CONTROLE DE PROGRESSO ===
    let numeroDevocional = localStorage.getItem("numeroDevocional");

    if (!numeroDevocional) {
      numeroDevocional = 1;
      localStorage.setItem("numeroDevocional", numeroDevocional);
      localStorage.setItem("ultimaDataAcesso", new Date().toDateString());
    } else {
      const ultimaData = localStorage.getItem("ultimaDataAcesso");
      const hojeStr = new Date().toDateString();

      if (ultimaData !== hojeStr) {
        numeroDevocional = parseInt(numeroDevocional) + 1;
        localStorage.setItem("numeroDevocional", numeroDevocional);
        localStorage.setItem("ultimaDataAcesso", hojeStr);
      }
    }

    // Carrega o devocional correspondente
    if (numeroDevocional > totalDevocionais) {
      window.location.href = "final.html";
    } else {
      const caminho = `devocionais/devocional-${numeroDevocional}.html`;
      fetch(caminho)
        .then(r => {
          if (!r.ok) throw new Error("Devocional n√£o encontrado");
          return r.text();
        })
        .then(html => {
          document.getElementById("devocional").innerHTML = html;

          // Insere a data do dia atual
          const agora = new Date();
          const dia = String(agora.getDate()).padStart(2, '0');
          const mes = String(agora.getMonth() + 1).padStart(2, '0');
          const ano = agora.getFullYear();
          const dataHojeFormatada = `${dia}/${mes}/${ano}`;

          const pDate = document.querySelector("#devocional p.date");
          if (pDate) pDate.textContent = dataHojeFormatada;
        })
        .catch(err => {
          document.getElementById("devocional").innerHTML = "<p style='text-align:center;'>Ops! O devocional deste dia ainda n√£o est√° dispon√≠vel.</p>";
          console.error(err);
        });
    }

    // === FUN√á√ÉO DE LEITURA CORRIGIDA ===
    function lerDevocional() {
      const devocionalEl = document.getElementById("devocional");
      if (!devocionalEl) return;

      const titulo = devocionalEl.querySelector("h1.titulo-devocional")?.innerText || "";
      let versiculo = devocionalEl.querySelector("p.verse")?.innerText || "";

      // Corrige refer√™ncia b√≠blica
      versiculo = versiculo.replace(/(\d+)\.(\d+)/g, "cap√≠tulo $1, vers√≠culo $2");

      let conteudo = "";

      // Conte√∫do principal
      devocionalEl.querySelectorAll(".content > p").forEach(p => {
        conteudo += p.innerText + " ";
      });

      // Aplica√ß√µes pr√°ticas
      const aplicacao = devocionalEl.querySelector(".practical");
      if (aplicacao) conteudo += aplicacao.innerText + " ";

      // Ora√ß√£o
      const oracao = devocionalEl.querySelector(".prayer");
      if (oracao) conteudo += oracao.innerText + " ";

      // √öltima frase (caso exista e n√£o seja parte da ora√ß√£o)
      const ultimaFrase = devocionalEl.querySelector(".content > p:last-of-type")?.innerText || "";
      if (ultimaFrase && !ultimaFrase.includes("Ora√ß√£o:")) conteudo += ultimaFrase;

      const textoCompleto = [titulo, versiculo, conteudo].join(". ");

      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(textoCompleto);
        utterance.lang = 'pt-BR';
        utterance.rate = 1;
        utterance.pitch = 1;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
      } else {
        alert("Desculpe, seu navegador n√£o suporta a leitura em voz alta.");
      }
    }

    document.getElementById("btn-ouvir").addEventListener("click", lerDevocional);
  </script>
</body>
</html>

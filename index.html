<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Devocional Diário</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;max-width:800px;margin:28px auto;padding:0 16px;color:#111}
    header{margin-bottom:18px}
    .date{color:#666;font-size:0.95rem}
    #content{margin-top:18px;padding:18px;border-radius:8px;background:#fafafa;box-shadow:0 1px 3px rgba(0,0,0,.06)}
    .error{color:#a33}
    .loader{opacity:.6}
    footer{margin-top:28px;color:#666;font-size:0.9rem}
  </style>
</head>
<body>
  <header>
    <h1>Devocional Diário</h1>
    <div class="date" id="displayDate">Carregando...</div>
  </header>

  <main>
    <div id="content" class="loader">Buscando devocional...</div>
  </main>

  <footer>
    <small>Se o devocional do dia não existir, será exibido o último disponível automaticamente.</small>
  </footer>

<script>
(async function(){
  const contentEl = document.getElementById('content');
  const displayDateEl = document.getElementById('displayDate');

  // --- CONFIGURAÇÃO (edite se quiser) ---
  const entriesPath = 'entries/';   // pasta onde estão os arquivos
  const dateFormat = d => d.toISOString().slice(0,10); // YYYY-MM-DD
  const maxFallbackDays = 7; // quantos dias retroceder se não encontrar o dia atual
  // ---------------------------------------

  // pega data local do visitante
  const today = new Date();
  // Se quiser fixar em um fuso horário (ex: São Paulo -3): descomente e ajuste abaixo
  // const tzOffsetHours = -3; today.setHours(today.getHours() + tzOffsetHours);

  displayDateEl.textContent = 'Hoje: ' + today.toLocaleDateString();

  async function fetchEntryFor(dateObj){
    const name = dateFormat(dateObj) + '.html';
    const url = entriesPath + name;
    try {
      const res = await fetch(url, {cache: "no-cache"});
      if (!res.ok) throw new Error('not found');
      const html = await res.text();
      return { ok:true, html, name };
    } catch(e) {
      return { ok:false, error:e };
    }
  }

  let loaded = false;
  for (let i=0;i<=maxFallbackDays;i++){
    const d = new Date(today);
    d.setDate(today.getDate() - i);
    const attempt = await fetchEntryFor(d);
    if (attempt.ok){
      contentEl.classList.remove('loader');
      contentEl.innerHTML = attempt.html;
      const shownDate = new Date(d);
      displayDateEl.textContent = 'Mostrando: ' + shownDate.toLocaleDateString() + ' (' + attempt.name + ')';
      loaded = true;
      break;
    }
  }

  if (!loaded){
    contentEl.classList.remove('loader');
    contentEl.innerHTML = '<p class="error">Devocional do dia não encontrado e nenhum fallback disponível.</p><p>Verifique se os arquivos em <code>' + entriesPath + '</code> foram enviados corretamente.</p>';
  }
})();
</script>
</body>
</html>
